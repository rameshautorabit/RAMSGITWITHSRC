<apex:page standardController="Opportunity" extensions="LineItemRelatedListCtlExt" tabStyle="Opportunity" id="listPage">
	
	<script type="text/javascript">
		
		function deleteconfirm(delId) {
			var r;
			
			r = confirm('Are you sure?');
			if (r == true) {
				delLine(delId);
			}
		}
	</script>
	
	<apex:form id="theForm" >
		<apex:actionfunction name="delLine" action="{!deleteLine}" reRender="theForm">
			<apex:param name="lineId" assignTo="{!deleteId}" value="" />
		</apex:actionfunction>
		
		<apex:pageMessages />
		
		<apex:pageBlock mode="detail" title="Opportunity Products">
		
			<apex:pageBlockButtons location="top">
				<apex:commandButton value="Add Product" onclick="window.top.location='/apex/AddProduct?id={!objId}&addTo={!objId}&retPage=opp&retURL=/{!objId}&sfdc.override=1'" disabled="{!fatalError}" />
				<apex:commandButton value="Product Details" onclick="window.top.location='/apex/OpportunityLineItems?id={!objId}'" disabled="{!fatalError}" />
				<apex:commandButton value="Sort" onclick="window.top.location='/apex/LineItemSort_OLI?id={!objId}&retURL=/{!objId}'" disabled="{!fatalError}" />
			</apex:pageBlockButtons>
			
			<apex:pageBlockSection columns="1" >
				<apex:pageBlockTable value="{!LineItems}" var="li" id="lineItemTable">
					
					<apex:column headerValue="Action" >
                    	<apex:outputLink value="/{!li.oli.Id}/e?retURL=/{!objId}" target="_top">Edit</apex:outputLink>
                    	&nbsp;|&nbsp;
                    	<apex:commandLink value="Del" onclick="deleteconfirm('{!li.oli.Id}');return false;"/>
                	</apex:column>
					
					<apex:column headerValue="Line #" >
                    	<apex:outputLink value="/{!li.oli.Id}" target="_blank">{!li.oli.Product2.Name}</apex:outputLink>
                	</apex:column>
                	
                	<apex:column headerValue="Product Name" >
                    	<apex:outputLink value="/{!li.oli.Product2Id}" target="_blank">{!li.oli.Actual_Product_Name__c}</apex:outputLink>
                	</apex:column>
                	
                	<apex:column headervalue="Quantity" value="{!li.oli.Quantity}" />
                	<apex:column headervalue="Direct Current Price" value="{!li.oli.Direct_Current_Price__c}" />
                	<apex:column headervalue="Contract Price" value="{!li.oli.UnitPrice}" />
                	<apex:column headervalue="Discount" value="{!li.oli.Percent_Discounted__c}" />
                	<apex:column headervalue="Margin" value="{!li.oli.Product_Margin__c}" />
                	<apex:column headervalue="Expected Delivery" value="{!li.oli.Delivery_Date__c}" />
                	<apex:column headervalue="Fulfillment" value="{!li.oli.Fulfillment_Method__c}" />
                	<apex:column headervalue="Notes" value="{!li.oli.Notes__c}" />
                	
                	<apex:column headerValue="Sort Order" >
						<apex:outputField value="{!li.oli.Sort_Order__c}" />
                	</apex:column>
                	
                </apex:pageBlockTable>
			</apex:pageBlockSection>
		</apex:pageBlock>
		
	</apex:form>
	
</apex:page>